<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>postgis-1 | Atma's blog</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#d4567b">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../rss.xml">
<link rel="canonical" href="https://atmamani.github.io/cheatsheets/open-geo/postgis-1/">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-113202945-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-113202945-1');
</script><meta name="author" content="Atma Mani">
<meta property="og:site_name" content="Atma's blog">
<meta property="og:title" content="postgis-1">
<meta property="og:url" content="https://atmamani.github.io/cheatsheets/open-geo/postgis-1/">
<meta property="og:description" content="This is PostGIS
Set up
Installation
I am installing the all-in-one package - Postgres APP which inclues Postgres, PostGIS, PLV8. Once installed, it looks like below:

I am following the tutorial from ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-10-11T13:24:49-07:00">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://atmamani.github.io/">

                <span id="blog-title">Atma's blog</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Projects <b class="caret"></b></a>
            <ul class="dropdown-menu">
<li>
<a href="../../../projects/math/">Learn math with Python</a>
                    </li>
<li>
<a href="../../../projects/stats/">Learn stats with Python</a>
                    </li>
<li>
<a href="../../../projects/ml/">Machine Learning projects</a>
                    </li>
<li>
<a href="../../../projects/dl/">Deep Learning projects</a>
                    </li>
<li>
<a href="../../../projects/spatial/">Spatial analysis</a>
                    </li>
<li>
<a href="../../../projects/thermal/">Thermal remote sensing</a>
                    </li>
<li>
<a href="../../../projects/mwrs/">Microwave remote sensing</a>
                    </li>
<li>
<a href="../../../projects/fun/">Fun projects</a>
            </li>
</ul>
</li>
<li>
<a href="../../../blog/">Blog</a>
                </li>
<li>
<a href="../../../talks/">Talks</a>
            </li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Cheatsheets <b class="caret"></b></a>
            <ul class="dropdown-menu">
<li>
<a href="../../learning-resources/">General learning resources</a>
                    </li>
<li>
<a href="../../../"><hr></a>
                    </li>
<li>
<a href="../../python/python_cheat_sheet_1/">Python basics, comprehensions</a>
                    </li>
<li>
<a href="../../python/python_cheat_sheet_2/">Python OO and exception handling</a>
                    </li>
<li>
<a href="../../python/python_cheat_sheet_3/">Python map, reduce, lambdas</a>
                    </li>
<li>
<a href="../../../images/regex-mindmap.jpg">Python regex</a>
                    </li>
<li>
<a href="../../../"><hr></a>
                    </li>
<li>
<a href="../../conda_cheat_sheet/">Conda basics</a>
                    </li>
<li>
<a href="../../../"><hr></a>
                    </li>
<li>
<a href="../../numpy/numpy_cheat_sheet_1/">NumPy basics</a>
                    </li>
<li>
<a href="../../numpy/numpy_cheat_sheet_2/">NumPy array slicing, dicing, searching</a>
                    </li>
<li>
<a href="../../../"><hr></a>
                    </li>
<li>
<a href="../../pandas/pandas_cheat_sheet_1/">Pandas basics</a>
                    </li>
<li>
<a href="../../pandas/pandas_cheat_sheet_2/">Pandas multilevel index, <br>    missing data, aggregation, merging</a>
                    </li>
<li>
<a href="../../pandas/pandas_cheat_sheet_3/">Productivity with Pandas</a>
                    </li>
<li>
<a href="../../pandas/pandas_data_viz_1/">Pandas data visualization</a>
                    </li>
<li>
<a href="../../../"><hr></a>
                    </li>
<li>
<a href="../../matplotlib/matplotlib_1/">Matplotlib basics</a>
                    </li>
<li>
<a href="../../matplotlib/matplotlib_2/">Matplotlib log scales, ticks, scientific</a>
                    </li>
<li>
<a href="../../../"><hr></a>
                    </li>
<li>
<a href="../../seaborn/seaborn_cheat_sheet_1/">Seaborn dist, joint, pair, rug plots</a>
                    </li>
<li>
<a href="../../seaborn/seaborn_cheat_sheet_2/">Seaborn categorical - bar, count, <br>violin, strip, swarm plots</a>
                    </li>
<li>
<a href="../../seaborn/seaborn_cheat_sheet_3/">Seaborn matrix, regression - heatmap, <br> cluster, regression</a>
                    </li>
<li>
<a href="../../seaborn/seaborn_cheat_sheet_4/">Seaborn grids &amp; custom - pair, facet grids <br> customization</a>
                    </li>
<li>
<a href="../../../"><hr></a>
                    </li>
<li>
<a href="../../plotly/plotly_cufflinks_cheat_sheet_1/">Plotly introduction</a>
                    </li>
<li>
<a href="../../plotly/plotly_cufflinks_cheat_sheet_2/">Plotly - interactive plotting</a>
                    </li>
<li>
<a href="../../plotly/plotly_geographical_plotting_1/">Plotly - geographic plotting</a>
                    </li>
<li>
<a href="../../../"><hr></a>
                    </li>
<li>
<a href="../../r_cheat_sheet_1/">R basics</a>
                    </li>
<li>
<a href="../../js_essentials/">Javascript essentials</a>
                    </li>
<li>
<a href="../../latex-1/">Latex introduction</a>
                    </li>
<li>
<a href="../../docker-1/">Docker introduction</a>
                    </li>
<li>
<a href="../../../"><hr></a>
                    </li>
<li>
<a href="../geopandas-1/">GeoPandas - IO, projections, plotting</a>
                    </li>
<li>
<a href="../geopandas-2/">GeoPandas - GP, IO, interactive plotting, geocoding</a>
                    </li>
<li>
<a href="../geopandas-3/">GeoPandas - spatial overlays, topology</a>
                    </li>
<li>
<a href="../geopandas-4/">GeoPandas - PySal, OSM data IO</a>
                    </li>
<li>
<a href="../open-geo-raster-1/">Rasterio - IO, plotting, histograms</a>
                    </li>
<li>
<a href="../open-geo-raster-2/">Rasterio - hyperspectral, SAM</a>
                    </li>
<li class="active">
<a href=".">PostGIS - introduction <span class="sr-only">(active)</span></a>
                    </li>
<li>
<a href="../postgis-2/">PostGIS - SQLAlchemy, GeoAlchemy, GeoPandas</a>
                    </li>
<li>
<a href="../../../"><hr></a>
                    </li>
<li>
<a href="../../web-development/">Web Development</a>
                    </li>
<li>
<a href="../../html/">HTML basics</a>
            </li>
</ul>
</li>
<li>
<a href="../../../apps/">Apps</a>
                </li>
<li>
<a href="../../../rss.xml">RSS feed</a>

                
            </li>
</ul>
<!-- DuckDuckGo custom search --><form method="get" id="search" action="https://duckduckgo.com/" class="navbar-form pull-left">
<input type="hidden" name="sites" value="https://atmamani.github.io/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Search…" class="span2" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
<!-- End of custom search -->


            <ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text storypage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">postgis-1</a></h1>

        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<h2>This is PostGIS</h2>
<h3>Set up</h3>
<h4>Installation</h4>
<p>I am installing the all-in-one package - Postgres APP which inclues Postgres, PostGIS, PLV8. Once installed, it looks like below:</p>
<p><img alt="" src="../../../images/postgresql-1.jpg"></p>
<p>I am following the <a href="https://postgis.net/workshops/postgis-intro/">tutorial from here</a></p>
<p>Note: There is an alternate download called 'OpenGeo Suite', but this is no longer in active development. It may have been acquired by boundless and now it does not resemble its original suite of products. Instead, I am installing <a href="https://www.pgadmin.org/download/">pgadmin</a> to admin the DB. The new pgAdmin4 is a complete rewrite. It is web based, written in Python, Qt, JS and core components in C++.</p>
<p>Once you install both the Postgres database and PgAdmin4 app, start both, connect to the database server using <code>localhost:5432</code> port (which you can look up from properties of db server). PgAdmin will now list the databases. Below is an image of the pgAdmin window running SQL queries on a custom DB I created.</p>
<p><img alt="" src="../../../images/pgAdmin-1.jpg"></p>
<h5>SQLAlchemy set up</h5>
<p>I am tripping when setting up sqlalchemy with postgres server in the geopandas env. It turns out, sqlalchemy requires a package called <code>psycopg2</code> which is not installed by default. In a clean env, installing these two works well. I am trying out in the geopandas env now.</p>
<p>Note: all I had to do was remove and reinstall <code>sqlalchemy</code> and <code>psycopg2</code>. Net, I had to recreate the whole package</p>
<h3>Introduction</h3>
<p>PostGIS is a spatial database. It turns PostgreSQL database into a spatial database. PostGIS inherits all enterprise functionality of PostgreSQL. There are 3 aspects that make a database spatial
 - <strong>spatial data types</strong> - store shapes as points ,lines, polygons. They abstract and encapsulate spatial structures such as boundary, dimension.
 - <strong>spatial indexing</strong> - for efficient spatial operations
 - <strong>spatial functions</strong> - exposed in SQL for querying spatial properties and relationships. Eg: answers which objects are within this particular envelope.</p>
<p>True spatial databases treat spatial features as first class database objs. Spatial DBs are used not just in geospatial env, but to store data related to anatomy of human body, large-scale integrated circuits, molecular structures, EMF etc.</p>
<p>More about <strong>Spatial index</strong>: Bounding boxes are used for spatial containment queries. Computing containment for polygons is very computationally intensive, hence it is performed over their respective bounding boxes. Computing this for rectangles is very simple and fast.</p>
<p>More about <strong>spatial functions</strong>: 5 main categories of spatial functions
- <strong>conversion</strong> of geometries
- <strong>management</strong> of spatial tables, PostGIS administration
- <strong>retrieval</strong> of properties and measurements of geometries
- <strong>comparison</strong> of geometries, wrt spatial relationship
- <strong>generation</strong> of new geometries.</p>
<p><strong>Notes</strong>: The PostGIS team outlines their reason behind choosing PostgreSQL as the foundation and not some other popular open source ORDBMS like mySQL.</p>
<h4>History of PostGIS</h4>
<p>Started in May of 2001. For many years, the functionality, power and ease of use was limited. <strong>MapServer</strong> became the first app to provide visualization of PostGIS. Later, another open source initiative <strong>GOES</strong> (Geometry Engine, Open Source) was integrated with PostGIS to make it complete</p>
<h3>Tutorial</h3>
<p>Follow tutorial from <a href="https://postgis.net/workshops/postgis-intro">postgis-intro</a></p>
<ol>
<li>To enable postGIS, run <code>CREATE EXTENSION postgis;</code>. Run by hitting <code>F5</code>. Then confirm it is installed by running <code>SELECT postgis_full_version();</code>
</li>
<li>To import data into postGIS, the tool <code>shp2pgis</code> extension does not seem available. Hence I did the import using QGIS. You can connect to the postGIS from qGIS using the same database server, port, db name. Then install the <strong>DB Admin</strong> QGIS extension to manage postGIS. The db manager looks like below:
   <img alt="" src="../../../images/qgis-to-postgis.jpg">
</li>
</ol>
<p>Once imported, you can query for the features from pgAdmin and also visualize the results like below:
<img alt="" src="../../../images/postgis-query.jpg"></p>
<h3>Working with Geometries in PostGIS</h3>
<p>A special table called <code>geometry_columns</code> exists which lists all tables within postGIS that are spatial. It lists details such as what their <code>SRID</code> is, their geometry type etc.</p>
<pre class="code literal-block"><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">geometry_columns</span>
</pre>


<p>Spatial functions can be used to collect information about each feature (row)</p>
<pre class="code literal-block"><span></span><span class="k">SELECT</span> <span class="n">name</span><span class="p">,</span> <span class="n">ST_GeometryType</span><span class="p">(</span><span class="n">geom</span><span class="p">),</span> <span class="n">ST_NDims</span><span class="p">(</span><span class="n">geom</span><span class="p">),</span> <span class="n">ST_SRID</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span>
  <span class="k">FROM</span> <span class="n">sample_geometries</span><span class="p">;</span>
</pre>


<p>will return</p>
<pre class="code literal-block"><span></span><span class="n">name</span>             <span class="o">|</span>    <span class="n">st_geometrytype</span>    <span class="o">|</span> <span class="n">st_ndims</span> <span class="o">|</span> <span class="n">st_srid</span>
<span class="c1">-----------------+-----------------------+----------+---------</span>
 <span class="n">Point</span>           <span class="o">|</span> <span class="n">ST_Point</span>              <span class="o">|</span>        <span class="mi">2</span> <span class="o">|</span>       <span class="mi">0</span>
 <span class="n">Polygon</span>         <span class="o">|</span> <span class="n">ST_Polygon</span>            <span class="o">|</span>        <span class="mi">2</span> <span class="o">|</span>       <span class="mi">0</span>
 <span class="n">PolygonWithHole</span> <span class="o">|</span> <span class="n">ST_Polygon</span>            <span class="o">|</span>        <span class="mi">2</span> <span class="o">|</span>       <span class="mi">0</span>
 <span class="n">Collection</span>      <span class="o">|</span> <span class="n">ST_GeometryCollection</span> <span class="o">|</span>        <span class="mi">2</span> <span class="o">|</span>       <span class="mi">0</span>
 <span class="n">Linestring</span>      <span class="o">|</span> <span class="n">ST_LineString</span>         <span class="o">|</span>        <span class="mi">2</span> <span class="o">|</span>       <span class="mi">0</span>
</pre>


<p><strong>Note</strong>: Spatial functions in postGIS are generally prefixed with <code>ST..</code></p>
<h4>Spatial functions for Point geometries</h4>
<p>Thus, to get the X, Y coordinates of a point, </p>
<pre class="code literal-block"><span></span><span class="k">SELECT</span> <span class="n">ST_X</span><span class="p">(</span><span class="n">geom</span><span class="p">),</span> <span class="n">ST_Y</span><span class="p">(</span><span class="n">geom</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">sample_geometries</span> <span class="k">where</span> <span class="n">name</span><span class="o">=</span><span class="s1">'Point'</span>
</pre>


<h4>Spatial functions for Linestring geometries</h4>
<ul>
<li>
<code>ST_Length(geometry)</code> returns the length of the linestring</li>
<li>
<code>ST_StartPoint(geometry)</code> returns the first coordinate as a point</li>
<li>
<code>ST_EndPoint(geometry)</code> returns the last coordinate as a point</li>
<li>
<code>ST_NPoints(geometry)</code> returns the number of coordinates in the linestring</li>
</ul>
<h4>Spatial functions for Polygon geometries</h4>
<ul>
<li>
<code>ST_Area(geometry)</code> returns the area of the polygons</li>
<li>
<code>ST_NRings(geometry)</code> returns the number of rings (usually 1, more of there are holes)</li>
<li>
<code>ST_ExteriorRing(geometry)</code> returns the outer ring as a linestring</li>
<li>
<code>ST_InteriorRingN(geometry,n)</code> returns a specified interior ring as a linestring</li>
<li>
<code>ST_Perimeter(geometry)</code> returns the length of all the rings</li>
</ul>
<h4>Spatial functions for Geometry Collections</h4>
<p>Geometry collections are the PolyLine, Multipoint, etc.</p>
<ul>
<li>
<code>ST_NumGeometries(geometry)</code> returns the number of parts in the collection</li>
<li>
<code>ST_GeometryN(geometry,n)</code> returns the specified part</li>
<li>
<code>ST_Area(geometry)</code> returns the total area of all polygonal parts</li>
<li>
<code>ST_Length(geometry)</code> returns the total length of all linear parts</li>
</ul>
<h3>Some SQL queries</h3>
<pre class="code literal-block"><span></span><span class="k">SELECT</span> <span class="n">boroname</span><span class="p">,</span> <span class="k">SUM</span><span class="p">(</span><span class="n">popn_white</span><span class="p">)</span><span class="o">/</span><span class="k">SUM</span><span class="p">(</span><span class="n">popn_total</span><span class="p">)</span> <span class="k">AS</span> <span class="n">white_pct</span>
  <span class="k">FROM</span> <span class="n">nyc_census_blocks</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">boroname</span><span class="p">;</span>
</pre>


<pre class="code literal-block"><span></span>
</pre>
</div>
    </div>
    

</article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2019         <a href="mailto:atma.mani@outlook.com">Atma Mani</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="../../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>
