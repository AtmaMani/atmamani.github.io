<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>AWS Lambda Functions - authoring with Docker images | Atma's blog</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#d4567b">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://atmamani.github.io/blog/aws-lambda-functions-with-docker-images/">
<link rel="icon" href="../../scatter-16.png" sizes="16x16">
<link rel="icon" href="../../scatter-32.png" sizes="32x32">
<link rel="icon" href="../../scatter-64.png" sizes="64x64">
<link rel="icon" href="../../scatter-128.png" sizes="128x128">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-113202945-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-113202945-1');
</script><meta name="author" content="Atma Mani">
<link rel="prev" href="../how-many-snakes-python-concurrency-1/" title="How many snakes do you need? - An introduction to concurrency and parallelism in Python" type="text/html">
<link rel="next" href="../deploying-deep-learning-inference-as-serverless-functions/" title="Donut or Not! - Deploying Deep Learning Inference as Serverless Functions" type="text/html">
<meta property="og:site_name" content="Atma's blog">
<meta property="og:title" content="AWS Lambda Functions - authoring with Docker images">
<meta property="og:url" content="https://atmamani.github.io/blog/aws-lambda-functions-with-docker-images/">
<meta property="og:description" content="At re:Invent 2020, AWS announced support for authoring, shipping and deploying the popular serverless Lambda services via Docker images. Further, they allow images up to 10GB in size. As multiple auth">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2021-09-20T14:05:00-07:00">
<meta property="article:tag" content="aws">
<meta property="article:tag" content="cloud">
<meta property="article:tag" content="cloud-compute">
<meta property="article:tag" content="lambda">
<meta property="article:tag" content="serverless">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://atmamani.github.io/">

                <span id="blog-title">Atma’s blog</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Projects <b class="caret"></b></a>
            <ul class="dropdown-menu">
<li>
<a href="../../projects/math/">Learn math with Python</a>
                    </li>
<li>
<a href="../../projects/stats/">Learn stats with Python</a>
                    </li>
<li>
<a href="../../projects/ml/">Machine Learning projects</a>
                    </li>
<li>
<a href="../../projects/dl/">Deep Learning projects</a>
                    </li>
<li>
<a href="../../projects/spatial/">Spatial analysis</a>
                    </li>
<li>
<a href="../../projects/thermal/">Thermal remote sensing</a>
                    </li>
<li>
<a href="../../projects/mwrs/">Microwave remote sensing</a>
                    </li>
<li>
<a href="../../projects/cloud/">Cloud computing</a>
                    </li>
<li>
<a href="../../projects/fun/">Fun projects</a>
            </li>
</ul>
</li>
<li>
<a href="../">Blog</a>
                </li>
<li>
<a href="../../talks/">Talks</a>
                </li>
<li>
<a href="../../books/">Books</a>
            </li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Cheatsheets <b class="caret"></b></a>
            <ul class="dropdown-menu">
<li>
<a href="../../cheatsheets/learning-resources/">General learning resources</a>
                    </li>
<li>
<a href="../../"><hr></a>
                    </li>
<li>
<a href="../../cheatsheets/python/python_datatypes/">Python datatypes</a>
                    </li>
<li>
<a href="../../cheatsheets/python/python_numeric_datatypes/">Python numeric datatypes</a>
                    </li>
<li>
<a href="../../cheatsheets/python/python_conditional_execution/">Python conditional execution</a>
                    </li>
<li>
<a href="../../cheatsheets/python/python_functions/">Python functions</a>
                    </li>
<li>
<a href="../../cheatsheets/python/python_iterations/">Python iterations</a>
                    </li>
<li>
<a href="../../cheatsheets/python/python_exception_handling/">Python exception handling</a>
                    </li>
<li>
<a href="../../cheatsheets/python/python_classes/">Python classes</a>
                    </li>
<li>
<a href="../../cheatsheets/python/python_memory/">Python memory, ref counts, garbage collection</a>
                    </li>
<li>
<a href="../../cheatsheets/python/python_mutability/">Python - mutability and immutability</a>
                    </li>
<li>
<a href="../../cheatsheets/python/python_language_optimizations/">Python - language optimizations</a>
                    </li>
<li>
<a href="../../images/regex-mindmap.jpg">Python regex</a>
                    </li>
<li>
<a href="../../"><hr></a>
                    </li>
<li>
<a href="../../cheatsheets/golang/">Go introduction</a>
                    </li>
<li>
<a href="../../cheatsheets/golang/golang-basics/">Go basics</a>
                    </li>
<li>
<a href="../../cheatsheets/golang/golang-datatypes/">Go data types</a>
                    </li>
<li>
<a href="../../cheatsheets/golang/golang-control-flow/">Go control flow</a>
                    </li>
<li>
<a href="../../cheatsheets/golang/goroutine/">Goroutines - concurrency in Go lang</a>
                    </li>
<li>
<a href="../../"><hr></a>
                    </li>
<li>
<a href="../../cheatsheets/conda_cheat_sheet/">Conda basics</a>
                    </li>
<li>
<a href="../../cheatsheets/mamba_cheat_sheet/">Mamba basics</a>
                    </li>
<li>
<a href="../../"><hr></a>
                    </li>
<li>
<a href="../../cheatsheets/numpy/numpy_cheat_sheet_1/">NumPy basics</a>
                    </li>
<li>
<a href="../../cheatsheets/numpy/numpy_cheat_sheet_2/">NumPy array slicing, dicing, searching</a>
                    </li>
<li>
<a href="../../"><hr></a>
                    </li>
<li>
<a href="../../cheatsheets/pandas/pandas_cheat_sheet_1/">Pandas basics</a>
                    </li>
<li>
<a href="../../cheatsheets/pandas/pandas_cheat_sheet_2/">Pandas multilevel index, <br>    missing data, aggregation, merging</a>
                    </li>
<li>
<a href="../../cheatsheets/pandas/pandas_cheat_sheet_3/">Productivity with Pandas</a>
                    </li>
<li>
<a href="../../cheatsheets/pandas/pandas_data_viz_1/">Pandas data visualization</a>
                    </li>
<li>
<a href="../../"><hr></a>
                    </li>
<li>
<a href="../../cheatsheets/matplotlib/matplotlib_1/">Matplotlib basics</a>
                    </li>
<li>
<a href="../../cheatsheets/matplotlib/matplotlib_2/">Matplotlib log scales, ticks, scientific</a>
                    </li>
<li>
<a href="../../cheatsheets/matplotlib/matplotlib_geo/">Geographical plotting with Basemap - matplotlib toolkit</a>
                    </li>
<li>
<a href="../../"><hr></a>
                    </li>
<li>
<a href="../../cheatsheets/seaborn/seaborn_cheat_sheet_1/">Seaborn dist, joint, pair, rug plots</a>
                    </li>
<li>
<a href="../../cheatsheets/seaborn/seaborn_cheat_sheet_2/">Seaborn categorical - bar, count, <br>violin, strip, swarm plots</a>
                    </li>
<li>
<a href="../../cheatsheets/seaborn/seaborn_cheat_sheet_3/">Seaborn matrix, regression - heatmap, <br> cluster, regression</a>
                    </li>
<li>
<a href="../../cheatsheets/seaborn/seaborn_cheat_sheet_4/">Seaborn grids <span class="amp">&amp;</span> custom - pair, facet grids <br> customization</a>
                    </li>
<li>
<a href="../../"><hr></a>
                    </li>
<li>
<a href="../../cheatsheets/plotly/plotly_cufflinks_cheat_sheet_1/">Plotly introduction</a>
                    </li>
<li>
<a href="../../cheatsheets/plotly/plotly_cufflinks_cheat_sheet_2/">Plotly - interactive plotting</a>
                    </li>
<li>
<a href="../../cheatsheets/plotly/plotly_geographical_plotting_1/">Plotly - geographic plotting</a>
                    </li>
<li>
<a href="../../"><hr></a>
                    </li>
<li>
<a href="../../cheatsheets/r_cheat_sheet_1/">R basics</a>
                    </li>
<li>
<a href="../../cheatsheets/octave-1/">Octave / <span class="caps">MATLAB</span> - basics</a>
                    </li>
<li>
<a href="../../cheatsheets/octave-2/">Octave - handling data</a>
                    </li>
<li>
<a href="../../cheatsheets/js_essentials/">Javascript essentials</a>
                    </li>
<li>
<a href="../../cheatsheets/latex-1/">Latex introduction</a>
                    </li>
<li>
<a href="../../cheatsheets/docker-1/">Docker introduction</a>
                    </li>
<li>
<a href="../../cheatsheets/grep-1/">Grep introduction</a>
                    </li>
<li>
<a href="../../"><hr></a>
                    </li>
<li>
<a href="../../cheatsheets/open-geo/geopandas-1/">GeoPandas - <span class="caps">IO</span>, projections, plotting</a>
                    </li>
<li>
<a href="../../cheatsheets/open-geo/geopandas-2/">GeoPandas - <span class="caps">GP</span>, <span class="caps">IO</span>, interactive plotting, geocoding</a>
                    </li>
<li>
<a href="../../cheatsheets/open-geo/geopandas-3/">GeoPandas - spatial overlays, topology</a>
                    </li>
<li>
<a href="../../cheatsheets/open-geo/geopandas-4/">GeoPandas - PySal, <span class="caps">OSM</span> data <span class="caps">IO</span></a>
                    </li>
<li>
<a href="../../cheatsheets/open-geo/open-geo-raster-1/">Rasterio - <span class="caps">IO</span>, plotting, histograms</a>
                    </li>
<li>
<a href="../../cheatsheets/open-geo/open-geo-raster-2/">Rasterio - hyperspectral, <span class="caps">SAM</span></a>
                    </li>
<li>
<a href="../../cheatsheets/open-geo/reading-multidim-data-using-opengeotools/">Reading multi-dimensional data using open geo tools</a>
                    </li>
<li>
<a href="../../cheatsheets/open-geo/postgis-1/">PostGIS - introduction</a>
                    </li>
<li>
<a href="../../cheatsheets/open-geo/postgis-2/">PostGIS - SQLAlchemy, GeoAlchemy, GeoPandas</a>
                    </li>
<li>
<a href="../../cheatsheets/open-geo/gdal-1/"><span class="caps">GDAL</span> - an introduction</a>
                    </li>
<li>
<a href="../../cheatsheets/open-geo/gdal-2/"><span class="caps">GDAL</span> - quickstart</a>
                    </li>
<li>
<a href="../../"><hr></a>
                    </li>
<li>
<a href="../../cheatsheets/web-development/">Web Development</a>
                    </li>
<li>
<a href="../../cheatsheets/html/"><span class="caps">HTML</span> basics</a>
            </li>
</ul>
</li>
<li>
<a href="../../apps/">Apps</a>
                </li>
<li>
<a href="../../rss.xml"><span class="caps">RSS</span> feed</a>

                
            </li>
</ul>
<!-- DuckDuckGo custom search --><form method="get" id="search" action="https://duckduckgo.com/" class="navbar-form pull-left">
<input type="hidden" name="sites" value="https://atmamani.github.io/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Search…" class="span2" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
<!-- End of custom search -->


            <ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url"><span class="caps">AWS</span> Lambda Functions - authoring with Docker images</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Atma Mani
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2021-09-20T14:05:00-07:00" itemprop="datePublished" title="2021-09-20 14:05">2021-09-20 14:05</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>At re:Invent 2020, <span class="caps">AWS</span> announced support for authoring, shipping and deploying the popular serverless Lambda services via Docker images. Further, they allow images up to <code>10GB</code> in size. As multiple authorities noted, this is a game changer, particularly for the scientific Python community as this would allow us to author machine learning and even deep learning inferencing functions using <span class="caps">AWS</span> Lambdas. This blog takes a quick look at authoring a “hello-world” style lambda using Docker.</p>
<!--TEASER_END-->

<p>To understand how Docker works or how to build Docker images, checkout my <a href="../../cheatsheets/docker-1">Docker 101 cheatsheet</a>. Having said that, you do not need to know much about Docker or containerization for simple functions.</p>
<h3 id="the-lambda-runtime-images">The Lambda runtime images<a href="#the-lambda-runtime-images" class="headerlink" title="Permalink to this heading">¶</a></h3>
<p><span class="caps">AWS</span> provides the runtime images for different languages, including Python. The images are shared at <code>DockerHub: amazon/aws-lambda-provided</code> and <code>ECR Public: public.ecr.aws/lambda/provided</code>. As expected, the base image is a flavor of linux called <strong>Amazon Linux</strong>.</p>
<h4 id="the-ric-and-the-rie">The <span class="caps">RIC</span> and the <span class="caps">RIE</span><a href="#the-ric-and-the-rie" class="headerlink" title="Permalink to this heading">¶</a></h4>
<p>The Python Docker images come with two important components pre-loaded. The <strong><span class="caps">RIC</span> - Runtime Interface Client</strong> provides the interface between Lambda (infrastructure) <span class="amp">&amp;</span> the function code. Think about the invoker from <span class="caps">API</span> gateway that runs your handler function. The <strong><span class="caps">RIE</span> - Runtime Interface Emulator</strong> is a tool that allows you to test the code locally.</p>
<h3 id="high-level-workflow">High-level workflow<a href="#high-level-workflow" class="headerlink" title="Permalink to this heading">¶</a></h3>
<p>The steps involved in publishing a Lambda function using Docker images will look like below</p>
<ol>
<li>Download base images in your language of choice</li>
<li>Package your code + dependencies + resource files into the image using Docker <span class="caps">CLI</span></li>
<li>Push the image into <strong><span class="caps">AWS</span> <span class="caps">ECR</span> - <span class="caps">AWS</span> Elastic Container Registry</strong>. <em>Note: You are not charged storage for these images</em>.</li>
<li>Create a function, choose ‘Container Image’ and the rest should be similar</li>
</ol>
<h4 id="gotchas">Gotchas<a href="#gotchas" class="headerlink" title="Permalink to this heading">¶</a></h4>
<ul>
<li>Image max size is <code>10 GB</code>
</li>
<li>Application code should run on a read-only file system. Only the <code>/tmp</code> dir is writable with <code>512 MB</code> storage</li>
<li>The container is instantiated with a user with least set of permissions. Ensure app code conforms with this.</li>
<li>Container settings</li>
</ul>
<div class="code"><pre class="code literal-block"><span class="n">ENTRYPOINT</span><span class="w"> </span><span class="err">–</span><span class="w"> </span><span class="n">Specifies</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">absolute</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">application</span><span class="o">.</span><span class="w"></span>
<span class="n">CMD</span><span class="w"> </span><span class="err">–</span><span class="w"> </span><span class="n">Specifies</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">want</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="k">pass</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">ENTRYPOINT</span><span class="o">.</span><span class="w"></span>
<span class="n">WORKDIR</span><span class="w"> </span><span class="err">–</span><span class="w"> </span><span class="n">Specifies</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">absolute</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">working</span><span class="w"> </span><span class="n">directory</span><span class="o">.</span><span class="w"></span>
<span class="n">ENV</span><span class="w"> </span><span class="err">–</span><span class="w"> </span><span class="n">Specifies</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Lambda</span><span class="w"> </span><span class="n">function</span><span class="o">.</span><span class="w"> </span>
</pre></div>

<h3 id="steps">Steps<a href="#steps" class="headerlink" title="Permalink to this heading">¶</a></h3>
<ul>
<li>Install <a href="https://docs.docker.com/get-docker">Docker for desktop</a> and <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html"><span class="caps">AWS</span> <span class="caps">CLI</span></a>
</li>
<li>Create your regular Lambda function into a folder called <code>app</code>. Store your <code>app.py</code>, <code>requirements.txt</code> files into it. See sample below:</li>
</ul>
<p><strong>app.py</strong>:</p>
<div class="code"><pre class="code literal-block"><span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">json</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="kn">import</span> <span class="nn">requests</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"All imports ok ..."</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Error Imports : </span><span class="si">{}</span><span class="s2"> "</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">lambda_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"Hello AWS!"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"event = </span><span class="si">{}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s1">'statusCode'</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
        <span class="s1">'message'</span><span class="p">:</span> <span class="s1">'hello from docker lambda'</span>
    <span class="p">}</span>
</pre></div>

<p><strong>requirements.txt</strong>:</p>
<div class="code"><pre class="code literal-block">requests
</pre></div>

<ul>
<li>Create a docker file as below:</li>
</ul>
<div class="code"><pre class="code literal-block"><span class="k">FROM</span><span class="w"> </span><span class="s">public.ecr.aws/lambda/python:3.8</span>

<span class="c"># Copy function code</span>
<span class="k">COPY</span><span class="w"> </span>app.py <span class="si">${</span><span class="nv">LAMBDA_TASK_ROOT</span><span class="si">}</span>

<span class="c"># Install the function's deps</span>
<span class="k">COPY</span><span class="w"> </span>requirements.txt  .
<span class="k">RUN</span><span class="w"> </span>pip3 install -r requirements.txt --target <span class="s2">"</span><span class="si">${</span><span class="nv">LAMBDA_TASK_ROOT</span><span class="si">}</span><span class="s2">"</span>

<span class="c"># set the CMD to handler</span>
<span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"app.lambda_handler"</span><span class="w"> </span><span class="p">]</span>
</pre></div>

<ul>
<li>Build Docker image using syntax <code>docker build -t &lt;username/imagename:tag&gt; &lt;build context&gt;</code>. For example: <code>docker build -t atmamani/aws-lambda-docker:v1 .</code>. This prints an output like below:</li>
</ul>
<div class="code"><pre class="code literal-block"><span class="o">[</span>+<span class="o">]</span> Building <span class="m">20</span>.7s <span class="o">(</span><span class="m">9</span>/9<span class="o">)</span> FINISHED                                                                                                 
 <span class="o">=</span>&gt; <span class="o">[</span>internal<span class="o">]</span> load build definition from Dockerfile                                                                         <span class="m">0</span>.0s
 <span class="o">=</span>&gt; <span class="o">=</span>&gt; transferring dockerfile: 44B                                                                                          <span class="m">0</span>.0s
 <span class="o">=</span>&gt; <span class="o">[</span>internal<span class="o">]</span> load .dockerignore                                                                                            <span class="m">0</span>.0s
 <span class="o">=</span>&gt; <span class="o">=</span>&gt; transferring context: 2B                                                                                              <span class="m">0</span>.0s
 <span class="o">=</span>&gt; <span class="o">[</span>internal<span class="o">]</span> load metadata <span class="k">for</span> public.ecr.aws/lambda/python:3.8                                                            <span class="m">0</span>.4s
 <span class="o">=</span>&gt; <span class="o">[</span>internal<span class="o">]</span> load build context                                                                                            <span class="m">0</span>.0s
 <span class="o">=</span>&gt; <span class="o">=</span>&gt; transferring context: 81B                                                                                             <span class="m">0</span>.0s
 <span class="o">=</span>&gt; <span class="o">[</span><span class="m">1</span>/4<span class="o">]</span> FROM public.ecr.aws/lambda/python:3.8@sha256:44c0de45aa1927eecd519ad48faa27fe3318717160b5f7560475d12abea7b427     <span class="m">18</span>.0s
 <span class="o">=</span>&gt; <span class="o">=</span>&gt; resolve public.ecr.aws/lambda/python:3.8@sha256:44c0de45aa1927eecd519ad48faa27fe3318717160b5f7560475d12abea7b427      <span class="m">0</span>.0s
 <span class="o">=</span>&gt; <span class="o">=</span>&gt; sha256:20666df3e004b212ed97db3bb9bc7cc0251d842f8b672f1722dc55c0d5f45367 <span class="m">74</span>.99kB / <span class="m">74</span>.99kB                             <span class="m">0</span>.8s
 <span class="o">=</span>&gt; <span class="o">=</span>&gt; sha256:f7ad8276137021bb0b0cbd6826ec86b0f04c78367e486f3c1728e389d1d400bc 415B / 415B                                   <span class="m">0</span>.8s
 <span class="o">=</span>&gt; <span class="o">=</span>&gt; sha256:44c0de45aa1927eecd519ad48faa27fe3318717160b5f7560475d12abea7b427 <span class="m">1</span>.58kB / <span class="m">1</span>.58kB                               <span class="m">0</span>.0s
 <span class="o">=</span>&gt; <span class="o">=</span>&gt; sha256:80342c69b467fef0607f90fd75c631fb351da1049b71faaaf98c8c1ce859c7b2 <span class="m">3</span>.00kB / <span class="m">3</span>.00kB                               <span class="m">0</span>.0s
 <span class="o">=</span>&gt; <span class="o">=</span>&gt; sha256:af4b61775d4cf0f587278cfbc2cbbc9afc3480f5fed5a455a9289c2c387c7187 <span class="m">100</span>.74MB / <span class="m">100</span>.74MB                           <span class="m">7</span>.5s
 <span class="o">=</span>&gt; <span class="o">=</span>&gt; sha256:bb2e44738d79a6afd429e2a103f081ad47783de7a6f7305664aee8a2e9e3976b <span class="m">3</span>.32MB / <span class="m">3</span>.32MB                               <span class="m">2</span>.4s
 <span class="o">=</span>&gt; <span class="o">=</span>&gt; sha256:891c7fcaabb6a1090e28f4d967f1e423aa7cfd1217267b7e9bfe6636cd7b08ef <span class="m">54</span>.77MB / <span class="m">54</span>.77MB                            <span class="m">10</span>.0s
 <span class="o">=</span>&gt; <span class="o">=</span>&gt; sha256:c1ae0f49cb65052f0d9674682af2b3bbe09c34fa37004930ef2e8019b76fa2d5 <span class="m">16</span>.10MB / <span class="m">16</span>.10MB                             <span class="m">6</span>.6s
 <span class="o">=</span>&gt; <span class="o">=</span>&gt; extracting sha256:af4b61775d4cf0f587278cfbc2cbbc9afc3480f5fed5a455a9289c2c387c7187                                    <span class="m">4</span>.9s
 <span class="o">=</span>&gt; <span class="o">=</span>&gt; extracting sha256:20666df3e004b212ed97db3bb9bc7cc0251d842f8b672f1722dc55c0d5f45367                                    <span class="m">0</span>.0s
 <span class="o">=</span>&gt; <span class="o">=</span>&gt; extracting sha256:f7ad8276137021bb0b0cbd6826ec86b0f04c78367e486f3c1728e389d1d400bc                                    <span class="m">0</span>.0s
 <span class="o">=</span>&gt; <span class="o">=</span>&gt; extracting sha256:bb2e44738d79a6afd429e2a103f081ad47783de7a6f7305664aee8a2e9e3976b                                    <span class="m">0</span>.1s
 <span class="o">=</span>&gt; <span class="o">=</span>&gt; extracting sha256:891c7fcaabb6a1090e28f4d967f1e423aa7cfd1217267b7e9bfe6636cd7b08ef                                    <span class="m">3</span>.0s
 <span class="o">=</span>&gt; <span class="o">=</span>&gt; extracting sha256:c1ae0f49cb65052f0d9674682af2b3bbe09c34fa37004930ef2e8019b76fa2d5                                    <span class="m">1</span>.5s
 <span class="o">=</span>&gt; <span class="o">[</span><span class="m">2</span>/4<span class="o">]</span> COPY app.py /var/task                                                                                              <span class="m">0</span>.1s
 <span class="o">=</span>&gt; <span class="o">[</span><span class="m">3</span>/4<span class="o">]</span> COPY requirements.txt  .                                                                                           <span class="m">0</span>.0s
 <span class="o">=</span>&gt; <span class="o">[</span><span class="m">4</span>/4<span class="o">]</span> RUN pip3 install -r requirements.txt --target <span class="s2">"/var/task"</span>                                                          <span class="m">2</span>.0s
 <span class="o">=</span>&gt; exporting to image                                                                                                       <span class="m">0</span>.1s
 <span class="o">=</span>&gt; <span class="o">=</span>&gt; exporting layers                                                                                                      <span class="m">0</span>.1s
 <span class="o">=</span>&gt; <span class="o">=</span>&gt; writing image sha256:ac4783629d43f0d1f2c641133419bf47b52531b7535bc2ad25dca73ab126f4ce                                 <span class="m">0</span>.0s 
 <span class="o">=</span>&gt; <span class="o">=</span>&gt; naming to docker.io/atmamani/aws-lambda-docker:v1                                                                     <span class="m">0</span>.0s
</pre></div>

<ul>
<li>Run the container locally using the command:</li>
</ul>
<div class="code"><pre class="code literal-block">(base) ➜  app git:(master) docker run -p 9000:8080 atmamani/aws-lambda-docker:v1
</pre></div>

<ul>
<li>You can test by posting <code>curl -XPOST "http://localhost:9000/2015-03-31/functions/function/invocations" -d '{}'</code>
</li>
<li>If you notice any errors, you can edit the files and rebuild the image and update the tag. THen you can retest the application.</li>
<li>Authenticate the <span class="caps">AWS</span> <span class="caps">CLI</span> by following <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-profiles.html">this help</a>.</li>
<li>Pass the auth from <span class="caps">AWS</span> <span class="caps">CLI</span> to Docker <span class="caps">CLI</span>, so Docker can tag and later push the images. Docker <span class="caps">CLI</span> normally pushes to the default DockerHub registry. However, for Lambda to work, you need to push to Amazon <span class="caps">ECR</span> registry. In <span class="caps">ECR</span>, I used the web <span class="caps">UI</span> to make a repository called <code>ml2web</code>.</li>
<li>Run below, where you replace <code>--region us-west-2</code> with your <span class="caps">AWS</span> region. You also replace <code>--profile &lt;aws_profile_name&gt;</code> with your <span class="caps">AWS</span> <span class="caps">CLI</span> profile name. If you are using just 1 account for all (don’t do this), then you can skip this argument. The Docker username needs to be <code>AWS</code> always. The <span class="caps">URL</span> like string is the name of your <span class="caps">ECR</span> registry.</li>
</ul>
<div class="code"><pre class="code literal-block"><span class="n">sudo</span><span class="w"> </span><span class="n">aws</span><span class="w"> </span><span class="n">ecr</span><span class="w"> </span><span class="n">get</span><span class="o">-</span><span class="n">login</span><span class="o">-</span><span class="n">password</span><span class="w"> </span><span class="o">--</span><span class="n">region</span><span class="w"> </span><span class="n">us</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mh">2</span><span class="w"> </span><span class="o">--</span><span class="n">profile</span><span class="w"> </span><span class="o">&lt;</span><span class="n">aws_profile_name</span><span class="o">&gt;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">docker</span><span class="w"> </span><span class="n">login</span><span class="w"> </span><span class="o">--</span><span class="n">username</span><span class="w"> </span><span class="n">AWS</span><span class="w"> </span><span class="o">--</span><span class="n">password</span><span class="o">-</span><span class="n">stdin</span><span class="w"> </span><span class="o">&lt;</span><span class="n">your_ECR_registry_name</span><span class="o">&gt;</span><span class="p">.</span><span class="n">dkr</span><span class="p">.</span><span class="n">ecr</span><span class="p">.</span><span class="n">us</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mf">2.</span><span class="n">amazonaws</span><span class="p">.</span><span class="n">com</span><span class="w"></span>
</pre></div>

<p>This threw an error saying permission denied, however it still works for me.</p>
<ul>
<li>
<p>Then tag your image using the command <code>docker tag atmamani/aws-lambda-docker:v2 &lt;your_ecr_name&gt;.dkr.ecr.us-west-2.amazonaws.com/ml2web:v2</code></p>
</li>
<li>
<p>Then push to <span class="caps">ECR</span> using the command: <code>docker push &lt;your_ECR_name&gt;.dkr.ecr.us-west-2.amazonaws.com/ml2web:v2</code></p>
</li>
</ul>
<div class="code"><pre class="code literal-block">The push refers to repository [your_ecr_name.dkr.ecr.us-west-2.amazonaws.com/ml2web]
6b5cd20ea590: Pushed 
aef77c8c9312: Pushed 
623b1ac50c4e: Pushed 
a1f8e0568112: Pushed 
bcf453d1de13: Pushed 
f6ae2f36d5d7: Pushed 
5959c8f9752b: Pushed 
3e5452c20c48: Pushed 
9c4b6b04eac3: Pushed 
v2: digest: sha256:abcdefgh_some_sha size: 2206
</pre></div>

<ul>
<li>Finally, use the Lambda web <span class="caps">UI</span> to create a new function. The only difference is, you choose ‘container image’ in the radio and provide the <span class="caps">URI</span> to the <span class="caps">ECR</span> registry. You can then browse for your image and tag and choose it.</li>
</ul>
<h3 id="sources">Sources<a href="#sources" class="headerlink" title="Permalink to this heading">¶</a></h3>
<ul>
<li><a href="https://docs.aws.amazon.com/lambda/latest/dg/runtimes-images.html">Runtime images</a></li>
<li><a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-images.html">Using container images with lambda</a></li>
<li><a href="https://aws.amazon.com/blogs/aws/new-for-aws-lambda-container-image-support/">Announcement blog</a></li>
<li><a href="https://docs.aws.amazon.com/lambda/latest/dg/images-create.html">Creating images using <span class="caps">AWS</span> base images</a></li>
</ul>
</div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/aws/" rel="tag">aws</a></li>
            <li><a class="tag p-category" href="../../categories/cloud/" rel="tag">cloud</a></li>
            <li><a class="tag p-category" href="../../categories/cloud-compute/" rel="tag">cloud-compute</a></li>
            <li><a class="tag p-category" href="../../categories/lambda/" rel="tag">lambda</a></li>
            <li><a class="tag p-category" href="../../categories/serverless/" rel="tag">serverless</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../how-many-snakes-python-concurrency-1/" rel="prev" title="How many snakes do you need? - An introduction to concurrency and parallelism in Python">Previous post</a>
            </li>
            <li class="next">
                <a href="../deploying-deep-learning-inference-as-serverless-functions/" rel="next" title="Donut or Not! - Deploying Deep Learning Inference as Serverless Functions">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2022         <a href="mailto:atma.mani@outlook.com">Atma Mani</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>