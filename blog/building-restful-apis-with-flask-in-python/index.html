<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Building RESTful APIs with Flask in Python | Atma's blog</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#d4567b">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://atmamani.github.io/blog/building-restful-apis-with-flask-in-python/">
<link rel="icon" href="../../scatter-16.png" sizes="16x16">
<link rel="icon" href="../../scatter-32.png" sizes="32x32">
<link rel="icon" href="../../scatter-64.png" sizes="64x64">
<link rel="icon" href="../../scatter-128.png" sizes="128x128">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-113202945-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-113202945-1');
</script><meta name="author" content="Atma Mani">
<link rel="prev" href="../design-principles-behind-restful-apis/" title="Design principles behind RESTful APIs" type="text/html">
<link rel="next" href="../gentle-introduction-cloud-computing/" title="A Gentle Introduction to Cloud Computing" type="text/html">
<meta property="og:site_name" content="Atma's blog">
<meta property="og:title" content="Building RESTful APIs with Flask in Python">
<meta property="og:url" content="https://atmamani.github.io/blog/building-restful-apis-with-flask-in-python/">
<meta property="og:description" content="This article demonstrates how to quickly build a RESTful API in Python using the Flask library. To know about RESTful APIs, read the article on Design principles behind RESTful APIs.


Boiler plate
Th">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-10-20T10:25:00-07:00">
<meta property="article:tag" content="flask">
<meta property="article:tag" content="python">
<meta property="article:tag" content="REST">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://atmamani.github.io/">

                <span id="blog-title">Atma's blog</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Projects <b class="caret"></b></a>
            <ul class="dropdown-menu">
<li>
<a href="../../projects/math/">Learn math with Python</a>
                    </li>
<li>
<a href="../../projects/stats/">Learn stats with Python</a>
                    </li>
<li>
<a href="../../projects/ml/">Machine Learning projects</a>
                    </li>
<li>
<a href="../../projects/dl/">Deep Learning projects</a>
                    </li>
<li>
<a href="../../projects/spatial/">Spatial analysis</a>
                    </li>
<li>
<a href="../../projects/thermal/">Thermal remote sensing</a>
                    </li>
<li>
<a href="../../projects/mwrs/">Microwave remote sensing</a>
                    </li>
<li>
<a href="../../projects/fun/">Fun projects</a>
            </li>
</ul>
</li>
<li>
<a href="../">Blog</a>
                </li>
<li>
<a href="../../talks/">Talks</a>
                </li>
<li>
<a href="../../books/">Books</a>
            </li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Cheatsheets <b class="caret"></b></a>
            <ul class="dropdown-menu">
<li>
<a href="../../cheatsheets/learning-resources/">General learning resources</a>
                    </li>
<li>
<a href="../../"><hr></a>
                    </li>
<li>
<a href="../../cheatsheets/python/python_datatypes/">Python datatypes</a>
                    </li>
<li>
<a href="../../cheatsheets/python/python_conditional_execution/">Python conditional execution</a>
                    </li>
<li>
<a href="../../cheatsheets/python/python_functions/">Python functions</a>
                    </li>
<li>
<a href="../../cheatsheets/python/python_iterations/">Python iterations</a>
                    </li>
<li>
<a href="../../cheatsheets/python/python_exception_handling/">Python exception handling</a>
                    </li>
<li>
<a href="../../cheatsheets/python/python_classes/">Python classes</a>
                    </li>
<li>
<a href="../../images/regex-mindmap.jpg">Python regex</a>
                    </li>
<li>
<a href="../../"><hr></a>
                    </li>
<li>
<a href="../../cheatsheets/conda_cheat_sheet/">Conda basics</a>
                    </li>
<li>
<a href="../../"><hr></a>
                    </li>
<li>
<a href="../../cheatsheets/numpy/numpy_cheat_sheet_1/">NumPy basics</a>
                    </li>
<li>
<a href="../../cheatsheets/numpy/numpy_cheat_sheet_2/">NumPy array slicing, dicing, searching</a>
                    </li>
<li>
<a href="../../"><hr></a>
                    </li>
<li>
<a href="../../cheatsheets/pandas/pandas_cheat_sheet_1/">Pandas basics</a>
                    </li>
<li>
<a href="../../cheatsheets/pandas/pandas_cheat_sheet_2/">Pandas multilevel index, <br>    missing data, aggregation, merging</a>
                    </li>
<li>
<a href="../../cheatsheets/pandas/pandas_cheat_sheet_3/">Productivity with Pandas</a>
                    </li>
<li>
<a href="../../cheatsheets/pandas/pandas_data_viz_1/">Pandas data visualization</a>
                    </li>
<li>
<a href="../../"><hr></a>
                    </li>
<li>
<a href="../../cheatsheets/matplotlib/matplotlib_1/">Matplotlib basics</a>
                    </li>
<li>
<a href="../../cheatsheets/matplotlib/matplotlib_2/">Matplotlib log scales, ticks, scientific</a>
                    </li>
<li>
<a href="../../cheatsheets/matplotlib/matplotlib_geo/">Geographical plotting with Basemap - matplotlib toolkit</a>
                    </li>
<li>
<a href="../../"><hr></a>
                    </li>
<li>
<a href="../../cheatsheets/seaborn/seaborn_cheat_sheet_1/">Seaborn dist, joint, pair, rug plots</a>
                    </li>
<li>
<a href="../../cheatsheets/seaborn/seaborn_cheat_sheet_2/">Seaborn categorical - bar, count, <br>violin, strip, swarm plots</a>
                    </li>
<li>
<a href="../../cheatsheets/seaborn/seaborn_cheat_sheet_3/">Seaborn matrix, regression - heatmap, <br> cluster, regression</a>
                    </li>
<li>
<a href="../../cheatsheets/seaborn/seaborn_cheat_sheet_4/">Seaborn grids &amp; custom - pair, facet grids <br> customization</a>
                    </li>
<li>
<a href="../../"><hr></a>
                    </li>
<li>
<a href="../../cheatsheets/plotly/plotly_cufflinks_cheat_sheet_1/">Plotly introduction</a>
                    </li>
<li>
<a href="../../cheatsheets/plotly/plotly_cufflinks_cheat_sheet_2/">Plotly - interactive plotting</a>
                    </li>
<li>
<a href="../../cheatsheets/plotly/plotly_geographical_plotting_1/">Plotly - geographic plotting</a>
                    </li>
<li>
<a href="../../"><hr></a>
                    </li>
<li>
<a href="../../cheatsheets/r_cheat_sheet_1/">R basics</a>
                    </li>
<li>
<a href="../../cheatsheets/octave-1/">Octave / MATLAB - basics</a>
                    </li>
<li>
<a href="../../cheatsheets/octave-2/">Octave - handling data</a>
                    </li>
<li>
<a href="../../cheatsheets/js_essentials/">Javascript essentials</a>
                    </li>
<li>
<a href="../../cheatsheets/latex-1/">Latex introduction</a>
                    </li>
<li>
<a href="../../cheatsheets/docker-1/">Docker introduction</a>
                    </li>
<li>
<a href="../../"><hr></a>
                    </li>
<li>
<a href="../../cheatsheets/open-geo/geopandas-1/">GeoPandas - IO, projections, plotting</a>
                    </li>
<li>
<a href="../../cheatsheets/open-geo/geopandas-2/">GeoPandas - GP, IO, interactive plotting, geocoding</a>
                    </li>
<li>
<a href="../../cheatsheets/open-geo/geopandas-3/">GeoPandas - spatial overlays, topology</a>
                    </li>
<li>
<a href="../../cheatsheets/open-geo/geopandas-4/">GeoPandas - PySal, OSM data IO</a>
                    </li>
<li>
<a href="../../cheatsheets/open-geo/open-geo-raster-1/">Rasterio - IO, plotting, histograms</a>
                    </li>
<li>
<a href="../../cheatsheets/open-geo/open-geo-raster-2/">Rasterio - hyperspectral, SAM</a>
                    </li>
<li>
<a href="../../cheatsheets/open-geo/reading-multidim-data-using-opengeotools/">Reading multi-dimensional data using open geo tools</a>
                    </li>
<li>
<a href="../../cheatsheets/open-geo/postgis-1/">PostGIS - introduction</a>
                    </li>
<li>
<a href="../../cheatsheets/open-geo/postgis-2/">PostGIS - SQLAlchemy, GeoAlchemy, GeoPandas</a>
                    </li>
<li>
<a href="../../"><hr></a>
                    </li>
<li>
<a href="../../cheatsheets/web-development/">Web Development</a>
                    </li>
<li>
<a href="../../cheatsheets/html/">HTML basics</a>
            </li>
</ul>
</li>
<li>
<a href="../../apps/">Apps</a>
                </li>
<li>
<a href="../../rss.xml">RSS feed</a>

                
            </li>
</ul>
<!-- DuckDuckGo custom search --><form method="get" id="search" action="https://duckduckgo.com/" class="navbar-form pull-left">
<input type="hidden" name="sites" value="https://atmamani.github.io/"><input type="hidden" name="k8" value="#444444"><input type="hidden" name="k9" value="#D51920"><input type="hidden" name="kt" value="h"><input type="text" name="q" maxlength="255" placeholder="Search…" class="span2" style="margin-top: 4px;"><input type="submit" value="DuckDuckGo Search" style="visibility: hidden;">
</form>
<!-- End of custom search -->


            <ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Building RESTful APIs with Flask in Python</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Atma Mani
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2019-10-20T10:25:00-07:00" itemprop="datePublished" title="2019-10-20 10:25">2019-10-20 10:25</time></a>
            </p>
            

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p><img src="https://www.fullstackpython.com/img/logos/flask.jpg" width="500"></p>
<p>This article demonstrates how to quickly build a RESTful API in Python using the <a href="https://www.fullstackpython.com">Flask</a> library. To know about RESTful APIs, read the article on <a href="../design-principles-behind-restful-apis/">Design principles behind RESTful APIs</a>.</p>
<!-- TEASER_END -->

<h3 id="boiler-plate">Boiler plate<a href="#boiler-plate" class="headerlink" title="Permalink to this heading">¶</a></h3>
<p>There is very little boiler plate necessary when defining a flask app. Something as limited as:</p>
<pre class="code literal-block"><span></span><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="kn">from</span> <span class="nn">datetime</span>

<span class="c1"># define a variable to hold you app</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># define your resource endpoints</span>
<span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">'/'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index_page</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">"Hello world"</span>

<span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">'/time'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">'GET'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">get_time</span><span class="p">():</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>

<span class="c1"># server the app when this file is run</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre>

<p>In the code above, you have defined 2 endpoints - a root <code>/</code> landing page and a <code>/time</code> endpoint. You can run this app from terminal as <code>python -m &lt;filename&gt;</code> which will start the webserver and give you an IP address to go or call.</p>
<h3 id="passing-arguments">Passing arguments<a href="#passing-arguments" class="headerlink" title="Permalink to this heading">¶</a></h3>
<p>When calling an endpoint, users can send the server some information. This info can be sent via <code>GET</code> or <code>POST</code> calls. By following HTTP verbs, if user wants to collect info back, they should send it via <code>GET</code>, else if the call is to perform some operation on the server side, then use <code>POST</code>, <code>PUT</code>, <code>DELETE</code>.</p>
<pre class="code literal-block"><span></span><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">request</span> <span class="c1"># used to parse payload</span>
<span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">'/hello'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">welcome_message</span><span class="p">():</span>
    <span class="sd">"""</span>
<span class="sd">    Called as /hello?name='value'</span>
<span class="sd">    """</span>
    <span class="c1"># if user sends payload to variable name, get it. Else empty string</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span> 
    <span class="k">return</span> <span class="sa">f</span><span class="s1">'Welcome </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">'</span>
</code></pre>

<p><strong>Note</strong>, sometimes your web app needs to make calls to other resources on the web. For this you can use the <code>requests</code> library. The <code>request</code> module of Flask used in the snippet is not to be confused with the <code>requests</code> library.</p>
<h3 id="rendering-html-pages">Rendering HTML pages<a href="#rendering-html-pages" class="headerlink" title="Permalink to this heading">¶</a></h3>
<p>Flask allows you to define a <code>templates</code> directory and put HTML pages into it. In these HTML pages, you can define variables and pass values to be displayed when rendering the HTML pages. This totally expands your possibilities without having to write a line of JS code.</p>
<pre class="code literal-block"><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">"en"</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">"UTF-8"</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Thermos - building webapis with flask<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
    A little bit about the machine running this site:

    <span class="p">&lt;</span><span class="nt">h4</span><span class="p">&gt;</span>OS type: {{os_type}}; OS name: {{os_name}}<span class="p">&lt;/</span><span class="nt">h4</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre>

<p>Put the above HTML page (saved as <code>index.html</code>) into a <code>templates</code> directory. Then you can render this page as</p>
<pre class="code literal-block"><span></span><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">render_template</span>
<span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">'/welcomePage'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">welcome_page</span><span class="p">():</span>

    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">'index.html'</span><span class="p">,</span>
                            <span class="s1">'os_type'</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="p">,</span>
                            <span class="s1">'os_name'</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</code></pre>

<h3 id="getting-user-input-via-html-pages">Getting user input via HTML pages<a href="#getting-user-input-via-html-pages" class="headerlink" title="Permalink to this heading">¶</a></h3>
<p>Not only are HTML pages good to display content on a UI, they are good to collect user input for processing. The snippet below defines a resource that when called via <code>GET</code>, will show an HTML page with form controls. If accessed via <code>POST</code>, it performs the actual processing defined by the resource.</p>
<pre class="code literal-block"><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">'/eyeFromAbove'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">'GET'</span><span class="p">,</span> <span class="s1">'POST'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">eye_from_above</span><span class="p">():</span>
    <span class="sd">"""</span>
<span class="sd">    If GET request - Displays a html page with box to enter address</span>
<span class="sd">    if POST request - renders output html with image from satellite</span>
<span class="sd">    :return:</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">'POST'</span><span class="p">:</span>
        <span class="c1"># User could have used the web UI or called the endpoint headless</span>

        <span class="c1"># If user used the web UI, then address comes as form data</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">address</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'address'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'date'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># request data comes via args</span>
            <span class="n">address</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'address'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">date</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'date'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">address</span><span class="p">:</span>
            <span class="n">geocode_dict</span> <span class="o">=</span> <span class="n">geocode_address_executor</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="n">geocode_dict</span><span class="p">[</span><span class="s1">'location'</span><span class="p">][</span><span class="s1">'x'</span><span class="p">]</span>
            <span class="n">lat</span> <span class="o">=</span> <span class="n">geocode_dict</span><span class="p">[</span><span class="s1">'location'</span><span class="p">][</span><span class="s1">'y'</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span> <span class="c1"># when no address is loaded</span>
            <span class="n">flash</span><span class="p">(</span><span class="s1">'No address specified'</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>

        <span class="n">base_url</span> <span class="o">=</span> <span class="s1">'https://api.nasa.gov/planetary/earth/imagery'</span>
        <span class="c1"># for some reason, NASA server rejects the GET request if I send data over payload</span>
        <span class="k">if</span> <span class="n">date</span><span class="p">:</span>
            <span class="n">full_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s1">/?lat=</span><span class="si">{</span><span class="n">lat</span><span class="si">}</span><span class="s1">&amp;lon=</span><span class="si">{</span><span class="n">lon</span><span class="si">}</span><span class="s1">&amp;date=</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s1">&amp;cloud_score=False&amp;api_key=</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">'</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">full_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">base_url</span><span class="si">}</span><span class="s1">/?lat=</span><span class="si">{</span><span class="n">lat</span><span class="si">}</span><span class="s1">&amp;lon=</span><span class="si">{</span><span class="n">lon</span><span class="si">}</span><span class="s1">&amp;cloud_score=False&amp;api_key=</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">'</span>


        <span class="c1"># construct the query and get download url</span>
        <span class="c1"># resp = requests.get(base_url, params)</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">full_url</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">resp_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">'error'</span><span class="p">:</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">})</span>

        <span class="c1"># Download the image from Google Earth Engine API.</span>
        <span class="n">img_resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">resp_dict</span><span class="p">[</span><span class="s1">'url'</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">img_resp</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">img_filename</span> <span class="o">=</span> <span class="n">address</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">' '</span><span class="p">,</span><span class="s1">'_'</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'-'</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'*'</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">','</span><span class="p">,</span><span class="s1">''</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">'eye_in_sky_queries/</span><span class="si">{</span><span class="n">img_filename</span><span class="si">}</span><span class="s1">.png'</span><span class="p">,</span> <span class="s1">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">img_handle</span><span class="p">:</span>
                <span class="n">img_handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">img_resp</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s1">'error'</span><span class="p">:</span><span class="n">img_resp</span><span class="o">.</span><span class="n">text</span><span class="p">})</span>

        <span class="c1"># render the HTML page</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">'eye_from_above.html'</span><span class="p">,</span>
                               <span class="n">media_type</span><span class="o">=</span><span class="s1">'image'</span><span class="p">,</span>
                               <span class="n">media_url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span><span class="s1">'eye_in_sky_queries'</span><span class="p">,</span><span class="n">img_filename</span><span class="o">+</span><span class="s1">'.png'</span><span class="p">),</span>
                               <span class="n">img_date</span> <span class="o">=</span> <span class="n">resp_dict</span><span class="p">[</span><span class="s1">'date'</span><span class="p">],</span>
                               <span class="n">img_id</span> <span class="o">=</span> <span class="n">resp_dict</span><span class="p">[</span><span class="s1">'id'</span><span class="p">],</span>
                               <span class="n">img_dataset</span> <span class="o">=</span> <span class="n">resp_dict</span><span class="p">[</span><span class="s1">'resource'</span><span class="p">][</span><span class="s1">'dataset'</span><span class="p">])</span>

    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">'GET'</span><span class="p">:</span>
        <span class="c1"># case when page is loaded on browser</span>
        <span class="k">return</span> <span class="s1">'''</span>
<span class="s1">            &lt;!doctype html&gt;</span>
<span class="s1">            &lt;title&gt;Enter address to view&lt;/title&gt;</span>
<span class="s1">            &lt;h1&gt;Enter the address to get image of&lt;/h1&gt;</span>
<span class="s1">            &lt;form method=post enctype=multipart/form-data&gt;</span>
<span class="s1">              &lt;input type=text name=address value=address&gt;</span>
<span class="s1">              &lt;input type=text name=date value='2013-12-17'&gt;</span>
<span class="s1">              &lt;input type=submit value=Submit&gt;</span>
<span class="s1">            &lt;/form&gt;</span>
<span class="s1">            '''</span>

<span class="c1"># this resource is needed to render images from disk. Needed for the template HTML pages</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">'/eye_in_sky_queries/&lt;filename&gt;'</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">uploaded_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">send_from_directory</span><span class="p">(</span><span class="s1">'eye_in_sky_queries'</span><span class="p">,</span>
                               <span class="n">filename</span><span class="p">)</span>
</code></pre>

<p>Now, to display the image, we need this part in the template HTML file</p>
<pre class="code literal-block"><span></span><code><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    {% if media_type == 'image' %}
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">{{media_url}}</span> <span class="na">class</span><span class="o">=</span><span class="s">"img-fluid"</span> <span class="na">alt</span><span class="o">=</span><span class="s">"Responsive image"</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</code></pre>

<h3 id="database-crud-operations">Database CRUD operations<a href="#database-crud-operations" class="headerlink" title="Permalink to this heading">¶</a></h3>
<p>One of the popular use cases of RESTful web services is, to perform operations on backend database via the web. In the snippet below, I am using <code>sqlalchemy</code> library to  create an in-memory <code>sqlite</code> database and perform CRUD - Create, Read, Update, Delete operations on it.</p>
<h4 id="sqlalchemy-in-2-minutes">
<code>sqlalchemy</code> in 2 minutes<a href="#sqlalchemy-in-2-minutes" class="headerlink" title="Permalink to this heading">¶</a></h4>
<p>Sqlalchemy library is an ORM (Object Relatinal Mapper) which allows representing database elements as Python objects. In addition, it allows you to connect to a DB and perform CRUD ops in addition to others.</p>
<p>Connecting to a DB. In this case a sqllite db is created. If you want the db in-memory, then specify <code>memory</code> as location.</p>
<pre class="code literal-block"><span></span><code><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">'sqlite:///filename.db'</span><span class="p">)</span>
</code></pre>

<p>The next step is to establish a session to this newly created db.</p>
<pre class="code literal-block"><span></span><code><span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">sessionmaker</span>
<span class="n">DBSession</span> <span class="o">=</span> <span class="n">sessionmaker</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>
<span class="n">my_session</span> <span class="o">=</span> <span class="n">DBSession</span><span class="p">()</span>
</code></pre>

<p>The next step is a little boiler plate and can be seen in many examples using sqlalchemy.</p>
<pre class="code literal-block"><span></span><code><span class="kn">from</span> <span class="nn">sqlalchemy.ext.declarative</span> <span class="kn">import</span> <span class="n">declarative_base</span>
<span class="n">Base</span> <span class="o">=</span> <span class="n">declarative_base</span><span class="p">()</span>
</code></pre>

<p>Next step is to create a Model - this represents the table, columns, rows as Python objects.</p>
<pre class="code literal-block"><span></span><code><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">Numeric</span><span class="p">,</span> <span class="n">String</span>

<span class="k">class</span> <span class="nc">Puppy</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span> <span class="c1">#must inherit from declarative base</span>
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">'puppy'</span>

    <span class="n">puppy_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">puppy_name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">[</span><span class="mi">30</span><span class="p">])</span>
    <span class="c1"># ... other columns</span>
</code></pre>

<p>Finnaly, we need to create the table define above on the db.</p>
<pre class="code literal-block"><span></span><code><span class="n">Base</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
</code></pre>

<h4 id="inserting-rows">Inserting rows<a href="#inserting-rows" class="headerlink" title="Permalink to this heading">¶</a></h4>
<p>Create an instance of the class you created that inherited the <code>declarative_base</code>.</p>
<pre class="code literal-block"><span></span><code><span class="n">puppy1</span> <span class="o">=</span> <span class="n">Puppy</span><span class="p">(</span><span class="n">puppy_name</span> <span class="o">=</span> <span class="s1">'nemo'</span><span class="p">)</span> <span class="c1">#pass the columns info to the constructor</span>

<span class="c1"># insert row</span>
<span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">puppy1</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</code></pre>

<p>Since, we did not pass <code>puppy_id</code>, the Primary key, the session knows this is a new row and it has to be created. Else, to edit an existing row, you still do an <code>add</code> but have the primary key specified.</p>
<h4 id="user-facing-crud-api">User facing CRUD API:<a href="#user-facing-crud-api" class="headerlink" title="Permalink to this heading">¶</a></h4>
<p>Below is an example endpoint that can perform all 4 CRUD operations:</p>
<pre class="code literal-block"><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">'/addresses/&lt;int:id&gt;'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">'GET'</span><span class="p">,</span> <span class="s1">'PUT'</span><span class="p">,</span> <span class="s1">'DELETE'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">address_id_handler</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="sd">"""</span>
<span class="sd">    GET - called as /addresses/25</span>
<span class="sd">    PUT - called to update as /addresses/25?address='abc'&amp;lat=25&amp;lon=89</span>
<span class="sd">    DELETE - called as /addresses/25</span>
<span class="sd">    :param id:</span>
<span class="sd">    :return:</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">'GET'</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">(</span><span class="n">read_address</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">address_id</span><span class="o">=</span><span class="nb">id</span><span class="p">))</span>

    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">'PUT'</span><span class="p">:</span>
        <span class="n">address</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'address'</span><span class="p">,</span><span class="s1">'dummy'</span><span class="p">)</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'lat'</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'lon'</span><span class="p">,</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="n">update_address</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">address_id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">search_string</span><span class="o">=</span><span class="n">address</span><span class="p">,</span> <span class="n">lat</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="o">=</span><span class="n">lon</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">'success'</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>

    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">'DELETE'</span><span class="p">:</span>
        <span class="n">delete_address</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
</code></pre>

<p>If you called <code>/addresses/&lt;id&gt;</code> with an existing <code>id</code> via <code>GET</code>, you perform a Read operation. Calling with a new <code>id</code> via <code>PUT</code> will do a Create operation. However, calling with an existing <code>id</code> via <code>PUT</code> will do an Update operation. Finally, <code>DELETE</code> will Delete that record from the DB.</p>
<h3 id="conclusion">Conclusion<a href="#conclusion" class="headerlink" title="Permalink to this heading">¶</a></h3>
<p>To view the full app in action, checkout <a href="../../apps/">the apps section</a> section. To see its source code, see this <a href="https://github.com/AtmaMani/thermos">GitHub repo</a>.</p>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../categories/flask/" rel="tag">flask</a></li>
            <li><a class="tag p-category" href="../../categories/python/" rel="tag">python</a></li>
            <li><a class="tag p-category" href="../../categories/rest/" rel="tag">REST</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../design-principles-behind-restful-apis/" rel="prev" title="Design principles behind RESTful APIs">Previous post</a>
            </li>
            <li class="next">
                <a href="../gentle-introduction-cloud-computing/" rel="next" title="A Gentle Introduction to Cloud Computing">Next post</a>
            </li>
        </ul></nav></aside></article>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2022         <a href="mailto:atma.mani@outlook.com">Atma Mani</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="../../assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>